<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
  <meta http-equiv="X-Clacks-Overhead" content="GNU Terry Pratchett" /> 

  <title>Turning kindle notes into a tidy data</title>
  <meta property="og:title" content="Turning kindle notes into a tidy data" />
  <meta name="twitter:title" content="Turning kindle notes into a tidy data" />
  <meta name="description" content="It is my dream to do everything with R. And we aRe almost there. We can write blogs in blogdown or bookdown, write reports in RMarkdown (thank you Yihui Xie!) create interactive webpages with Shiny (thank you Winston Chang). Control our lifx lights with lifxr (great work Carl!) and use emoticons everywhere with the emo package.
There is even a novel of my vision! I recently found chapter 40 of A Dr.">
  <meta property="og:description" content="It is my dream to do everything with R. And we aRe almost there. We can write blogs in blogdown or bookdown, write reports in RMarkdown (thank you Yihui Xie!) create interactive webpages with Shiny (thank you Winston Chang). Control our lifx lights with lifxr (great work Carl!) and use emoticons everywhere with the emo package.
There is even a novel of my vision! I recently found chapter 40 of A Dr.">
  <meta name="twitter:description" content="It is my dream to do everything with R. And we aRe almost there. We can write blogs in blogdown or bookdown, write reports in RMarkdown (thank you Yihui Xie!) create interactive webpages with Shiny ‚Ä¶">
  <meta name="author" content="Roel M. Hogervorst"/>
  <link href='http://rmhogervorst.nl/cleancode/img/favicon.ico' rel='icon' type='image/x-icon'/>
  <meta property="og:image" content="http://rmhogervorst.nl/cleancode/img/avatar-icon.png" />
  <meta name="twitter:image" content="http://rmhogervorst.nl/cleancode/img/avatar-icon.png" />
  <meta name="twitter:card" content="summary" />
  <meta name="twitter:site" content="@RMHoge" />
  <meta name="twitter:creator" content="@RMHoge" />
  <meta property="og:url" content="http://rmhogervorst.nl/cleancode/blog/2017/05/08/content/post/2017-05-08-making-kindle-highlights-tidy/" />
  <meta property="og:type" content="website" />
  <meta property="og:site_name" content="Clean Code (and R-fun)" />

  <meta name="generator" content="Hugo 0.35" />
  <link rel="canonical" href="http://rmhogervorst.nl/cleancode/blog/2017/05/08/content/post/2017-05-08-making-kindle-highlights-tidy/" />
  <link rel="alternate" href="http://rmhogervorst.nl/cleancode/index.xml" type="application/rss+xml" title="Clean Code (and R-fun)">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.7.1/katex.min.css" integrity="sha384-wITovz90syo1dJWVh32uuETPVEtGigN07tkttEqPv+uR2SE/mbQcG7ATL28aI9H0" crossorigin="anonymous">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha384-wvfXpqpZZVQGK6TAh5PVlGOfQNHSoD2xbE+QkPxCAFlNEevoEH3Sl0sibVcOQVnN" crossorigin="anonymous">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
  <link rel="stylesheet" href="http://rmhogervorst.nl/cleancode/css/main.css" /><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic" />
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800" /><link rel="stylesheet" href="http://rmhogervorst.nl/cleancode/css/syntax.css" /><link rel="stylesheet" href="http://rmhogervorst.nl/cleancode/css/codeblock.css" />



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.2/photoswipe.min.css" integrity="sha384-h/L2W9KefUClHWaty3SLE5F/qvc4djlyR4qY3NUV5HGQBBW7stbcfff1+I/vmsHh" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.2/default-skin/default-skin.min.css" integrity="sha384-iD0dNku6PYSIQLyfTOpB06F2KCZJAKLOThS5HRe8b3ibhdEQ6eKsFf/EeFxdOt5R" crossorigin="anonymous">



<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

<div class="pswp__bg"></div>

<div class="pswp__scroll-wrap">
    
    <div class="pswp__container">
      <div class="pswp__item"></div>
      <div class="pswp__item"></div>
      <div class="pswp__item"></div>
    </div>
    
    <div class="pswp__ui pswp__ui--hidden">
    <div class="pswp__top-bar">
      
      <div class="pswp__counter"></div>
      <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
      <button class="pswp__button pswp__button--share" title="Share"></button>
      <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
      <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>
      
      
      <div class="pswp__preloader">
        <div class="pswp__preloader__icn">
          <div class="pswp__preloader__cut">
            <div class="pswp__preloader__donut"></div>
          </div>
        </div>
      </div>
    </div>
    <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
      <div class="pswp__share-tooltip"></div>
    </div>
    <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
    </button>
    <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
    </button>
    <div class="pswp__caption">
      <div class="pswp__caption__center"></div>
    </div>
    </div>
    </div>
</div>

</head>

  <body>
    <nav class="navbar navbar-default navbar-fixed-top navbar-custom">
  <div class="container-fluid">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#main-navbar">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="http://rmhogervorst.nl/cleancode">Clean Code (and R-fun)</a>
    </div>

    <div class="collapse navbar-collapse" id="main-navbar">
      <ul class="nav navbar-nav navbar-right">
        

        

        
      </ul>
    </div>

    <div class="avatar-container">
      <div class="avatar-img-border">
        
          <a title="Clean Code (and R-fun)" href="http://rmhogervorst.nl/cleancode">
            <img class="avatar-img" src="http://rmhogervorst.nl/cleancode/img/avatar-icon.png" alt="Clean Code (and R-fun)" />
          </a>
        
      </div>
    </div>

  </div>
</nav>




    
  
  
  




  

  <header class="header-section ">
    
    <div class="intro-header no-img">
      
      <div class="container">
        <div class="row">
          <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
            <div class="post-heading">
              <h1>Turning kindle notes into a tidy data</h1>
                
                
                  <span class="post-meta">
  
  
  <i class="fa fa-calendar-o"></i>&nbsp;Posted on May 8, 2017
  
  
  &nbsp;|&nbsp;
  <i class="fa fa-clock-o"></i> 12 minutes (2380 words)
  
  
</span>


                
            </div>
          </div>
        </div>
      </div>
    </div>
  </header>


    
<div class="container" role="main">
  <div class="row">
    <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
      <article role="main" class="blog-post">
        

<p>It is my dream to do everything with R. And we aRe almost there. We can write blogs in blogdown or bookdown, write reports in RMarkdown (thank you <a href="https://twitter.com/xieyihui">Yihui Xie!</a>) create interactive webpages with Shiny (thank you <a href="https://twitter.com/winston_chang">Winston Chang</a>). Control our lifx lights with <a href="https://github.com/cboettig/lifxr">lifxr</a> (great work <a href="http://carlboettiger.info/">Carl!</a>) and use emoticons everywhere with the emo package.</p>

<p>There is even a novel of my vision! I recently found chapter 40 of <a href="http://www.psi-chology.com/the-day-the-priming-stopped/">A Dr. Primestein Adventure‚Ñ¢ The Day the Priming Stopped</a>. There is a scene in there which says:</p>

<blockquote>
<p>‚ÄúThis Fortress is a monumental technological achievement,‚Äù explained Professor Power. ‚ÄúEvery aspect of the Fortress‚Äôs security is run by R.‚Äù As they arrived at the metal doors, the Professor pressed a small button on the wall to the right. ‚ÄúThis is an elevatoR, run by its own R package.‚Äù They waited for the doors to open, but nothing happened. After a few minutes of alternately waiting and then mashing the elevatoR button, Professor Power called someone on his mobile phone. ‚ÄúThe elevatoR is not working&hellip;what? Why would they do that?&hellip;call Hadley Wickham!&hellip;doesn‚Äôt anyone around here check packages against the development version of R before upgrading?&hellip;yes, we‚Äôll wait.‚Äù ‚ÄúSomeone upgraded R without permission. Should be fixed soon,‚Äù Professor Power explained.</p>
</blockquote>

<p>But enough about jokeRs and jesteRs. As it is my life long mission to do everything in R and preferably in the <a href="http://tidyverse.org/">tidyverse</a>, I found something that wasn&rsquo;t tidy üòû !!! Kindle notes!</p>

<h1 id="kindle-notes-and-highlights">kindle notes and highlights.</h1>

<p>I have a 2010 kindle to read E-books on and once in a while I write a note or highlight some text in the book. If you connect your kindle to the computer you can extract the highlights by copying the file `My Clippings.txt&rsquo; to your computer.</p>

<p>This is great, it&rsquo;s a text file which means you can open it on every computer and search throug the contents. However&hellip;</p>

<blockquote>
<p>It&rsquo;s not tidy.</p>
</blockquote>

<p>Let&rsquo;s change that. The general procedure is thus:</p>

<ol>
<li>Create a new project in Rstudio</li>
<li>Create a new folder called <code>data</code> (or don&rsquo;t but really this is neat isn&rsquo;t it?)</li>
<li>Copy the <code>My Clippings.txt</code> file to that <code>data</code>-folder</li>
<li>Load the tidyverse `library(tidyverse)&rsquo;</li>
<li>Hammer away untill the txt file is a data frame.</li>
<li>profit?</li>
</ol>

<h3 id="what-is-in-this-text-file">What is in this text file?</h3>

<p>First we do some exploratory work on the file. I&rsquo;ve found that the text file is structured in a particular way:</p>

<pre><code>title  (author)
- Highlight on Page 128 | Loc. 1962-68  | Added on Sunday, December 27, 2015, 03:09 PM
&lt;empty line&gt;
highlighted text
==========
title of the next highlighted book (author)
etc.
</code></pre>

<p><strong>So how do we force this into a data frame?</strong></p>

<p>Recognize the structure ( we will create functions for that)</p>

<ul>
<li>Chunks end with the ten ===== signs, we can split on that</li>
<li>first line is the title and (author)</li>
<li><em>we can seperate the author and the title</em></li>
<li>next line of information is devided by &lsquo;|&rsquo; signs.</li>
<li><em>type, page, location, added date and time (in american time of course&hellip;)</em></li>
<li>highlighted text (or if it is a bookmark, nothing)</li>
</ul>
<div class="highlight"><pre class="chroma"><code class="language-r" data-lang="r"><span class="kn">library</span><span class="p">(</span>tidyverse<span class="p">)</span></code></pre></div>
<pre><code>## Loading tidyverse: ggplot2
## Loading tidyverse: tibble
## Loading tidyverse: tidyr
## Loading tidyverse: readr
## Loading tidyverse: purrr
## Loading tidyverse: dplyr

## Conflicts with tidy packages ----------------------------------------------

## filter(): dplyr, stats
## lag():    dplyr, stats
</code></pre>
<div class="highlight"><pre class="chroma"><code class="language-r" data-lang="r">raw_text <span class="o">&lt;-</span> read_file<span class="p">(</span><span class="s">&#34;data/My Clippings.txt&#34;</span><span class="p">)</span> <span class="c1"># read in the text file</span>
per_chunk <span class="o">&lt;-</span> <span class="kp">unlist</span><span class="p">(</span><span class="kp">strsplit</span><span class="p">(</span>raw_text<span class="p">,</span> <span class="s">&#34;==========&#34;</span><span class="p">))</span>  <span class="c1"># seperate into chunks</span>
per_chunk<span class="p">[</span><span class="m">4</span><span class="p">]</span></code></pre></div>
<pre><code>## [1] &quot;\r\nThe Clean Coder_ A Code of Conduct For Professional Programmers - Robert C. Martin (Robert C. Martin)\r\n- Highlight on Page 90 | Added on Monday, January 25, 2016, 04:06 PM\r\n\r\nK ATA In martial arts, a kata is a precise set of choreographed movements that simulates one side of a combat. The goal, which is asymptotically approached, is perfection. The artist strives to teach his body to make each movement perfectly and to assemble those movements into fluid enactment. Well-executed kata are beautiful to watch. Beautiful though they are, the purpose of learning a kata is not to perform it on stage. The purpose is to train your mind and body how to react in a particular combat situation. The goal is to make the perfected movements automatic and instinctive so that they are there when you need them. A programming kata is a precise set of choreographed keystrokes and mouse movements that simulates the solving of some programming problem. You aren¬ít actually solving the problem because you already know the solution. Rather, you are practicing the movements and decisions involved in solving the problem.\r\n&quot;
</code></pre>

<p>Above I have created seperate chunks that represent seperate highlights. And a example so you can see what I see.</p>

<p>Now for extracting the seperate elements. I create functions that do one thing.</p>
<div class="highlight"><pre class="chroma"><code class="language-r" data-lang="r"><span class="c1"># This function takes a chunk of character information</span>
<span class="c1"># and seperates it into lines. </span>
seperate_into_lines <span class="o">&lt;-</span> <span class="kr">function</span><span class="p">(</span>chunk<span class="p">){</span>
    result <span class="o">&lt;-</span> stringr<span class="o">::</span>str_split<span class="p">(</span>chunk<span class="p">,</span> <span class="s">&#34;\r\n&#34;</span><span class="p">)</span>
    <span class="kp">unlist</span><span class="p">(</span>result<span class="p">)</span>
<span class="p">}</span>
<span class="c1"># result &lt;- seperate_into_lines(per_chunk[100])  # testing if this works </span>
<span class="c1">## you should put this into formal test frameworks such as testhat if you</span>
<span class="c1">## build a package. </span>



<span class="c1"># Extract title sentance and remove author</span>
<span class="c1"># This function presumes that you already extracted the raw data into</span>
<span class="c1"># character chunks.</span>
extract_title <span class="o">&lt;-</span> <span class="kr">function</span><span class="p">(</span>linechunk<span class="p">){</span>
    <span class="c1"># search for second line</span>
    titleline <span class="o">&lt;-</span> linechunk<span class="p">[</span><span class="m">2</span><span class="p">]</span>
    <span class="kr">return</span> <span class="o">&lt;-</span> <span class="kp">gsub</span><span class="p">(</span><span class="s">&#34;\\(.*\\)&#34;</span><span class="p">,</span> <span class="s">&#34;&#34;</span><span class="p">,</span> titleline<span class="p">)</span> <span class="c1"># it took me some </span>
            <span class="c1">#time to work this regular expression out.</span>
    stringr<span class="o">::</span>str_trim<span class="p">(</span><span class="kr">return</span><span class="p">,</span> side <span class="o">=</span> <span class="s">&#34;both&#34;</span><span class="p">)</span> <span class="c1"># remove whitespace at ends</span>
<span class="p">}</span>
<span class="c1">#extract_title(result) # testcase to see if it works for me.</span>


<span class="c1"># Extract the author from chunk, this function looks </span>
<span class="c1"># very much like the one above, it uses the same logic.</span>
extract_author <span class="o">&lt;-</span> <span class="kr">function</span><span class="p">(</span>linechunk<span class="p">){</span>
    <span class="c1"># search for second line</span>
    titleline <span class="o">&lt;-</span> linechunk<span class="p">[</span><span class="m">2</span><span class="p">]</span> <span class="c1"># identical</span>
    author <span class="o">&lt;-</span> stringr<span class="o">::</span>str_extract<span class="p">(</span>titleline<span class="p">,</span> <span class="s">&#34;\\(.*\\)&#34;</span><span class="p">)</span> <span class="c1"># extract piece</span>
    <span class="kr">return</span> <span class="o">&lt;-</span> <span class="kp">gsub</span><span class="p">(</span><span class="s">&#34;\\(|\\)&#34;</span><span class="p">,</span> <span class="s">&#34;&#34;</span><span class="p">,</span> author<span class="p">)</span>  <span class="c1"># </span>
    stringr<span class="o">::</span>str_trim<span class="p">(</span><span class="kr">return</span><span class="p">,</span> side <span class="o">=</span> <span class="s">&#34;both&#34;</span><span class="p">)</span>
<span class="p">}</span>
<span class="c1"># extract_author(result)</span></code></pre></div>
<p>Let&rsquo;s see if this works on a subset of the data. I usually take multiple notes in one book before I open another, so in this case the first 20 notes are really boring and all from the same book. To spice this up I take a random subset of rows. I will use a simple for-loop here, but I will use functional programming in the end-result. It works kind of the same, but is more explicit.</p>

<p>Some people will tell you that for-loops are slow in R, or that &lsquo;loops are bad&rsquo; but they don&rsquo;t know what they are talking about.[1]</p>

<p>I first create a data_frame [2] and pre-populate it.</p>
<div class="highlight"><pre class="chroma"><code class="language-r" data-lang="r"><span class="c1"># testset &lt;- per_chunk[1:20]  # You would use this if you want the first 20 pieces.</span>
<span class="kp">set.seed</span><span class="p">(</span><span class="m">4579</span><span class="p">)</span>  <span class="c1"># if you do random stuff, it is wise to </span>
<span class="c1"># set the seed so that others can reproduce your work.</span>
testset <span class="o">&lt;-</span> per_chunk<span class="p">[</span>base<span class="o">::</span><span class="kp">sample</span><span class="p">(</span>x <span class="o">=</span><span class="m">1</span><span class="o">:</span><span class="kp">length</span><span class="p">(</span>per_chunk<span class="p">),</span>size <span class="o">=</span> <span class="m">20</span><span class="p">)]</span> 
<span class="c1"># unfortunately dplyr also has a function called sample. to specify that</span>
<span class="c1"># we want the &#39;normal&#39; one I specify the name of the package followed by</span>
<span class="c1"># two &#39;:&#39;. </span>
testingframe <span class="o">&lt;-</span> <span class="kt">data_frame</span><span class="p">(</span>
    author <span class="o">=</span> <span class="kt">character</span><span class="p">(</span>length <span class="o">=</span> <span class="kp">length</span><span class="p">(</span>testset<span class="p">)),</span>
    title <span class="o">=</span> <span class="kt">character</span><span class="p">(</span><span class="kp">length</span><span class="p">(</span>testset<span class="p">)))</span>
<span class="kr">for</span><span class="p">(</span> i <span class="kr">in</span> <span class="kp">seq_along</span><span class="p">(</span>testset<span class="p">)){</span>
    hold <span class="o">&lt;-</span> testset<span class="p">[</span>i<span class="p">]</span> <span class="o">%&gt;%</span> seperate_into_lines<span class="p">()</span>
    testingframe<span class="o">$</span>author<span class="p">[</span>i<span class="p">]</span> <span class="o">&lt;-</span> hold <span class="o">%&gt;%</span> extract_author<span class="p">()</span>
    testingframe<span class="o">$</span>title <span class="o">&lt;-</span> hold <span class="o">%&gt;%</span> extract_title<span class="p">()</span>
<span class="p">}</span>
testingframe</code></pre></div>
<pre><code>## # A tibble: 20 √ó 2
##                                     author
##                                      &lt;chr&gt;
## 1             Andrew Hunt and David Thomas
## 2             Andrew Hunt and David Thomas
## 3                            Alex Reinhart
## 4                              David Price
## 5            City Watch #1 Terry Pratchett
## 6            City Watch #1 Terry Pratchett
## 7                              Mark Manson
## 8                     Kim Stanley Robinson
## 9                     Kim Stanley Robinson
## 10                    Kim Stanley Robinson
## 11         Douglas DeCarlo, James P. Lewis
## 12                             David Price
## 13           City Watch #2 Terry Pratchett
## 14 Kenneth Knoblauch &amp; Laurence T. Maloney
## 15                           Alex Reinhart
## 16            Andrew Hunt and David Thomas
## 17                        Robert C. Martin
## 18            Andrew Hunt and David Thomas
## 19            Andrew Hunt and David Thomas
## 20                             David Price
## # ... with 1 more variables: title &lt;chr&gt;
</code></pre>

<p>The author and title functions seem to work, let&rsquo;s extract some more information. The third row contained multiple pieces of information</p>

<p>example:</p>

<pre><code>- Highlight on Page 132 | Loc. 2017-20  | Added on Saturday, August 20, 2016, 09:37 AM
</code></pre>

<p>Like the first functions we first select the correct row [3] and than apply some magic.</p>
<div class="highlight"><pre class="chroma"><code class="language-r" data-lang="r"><span class="c1"># this function extracts all the pieces</span>
<span class="c1"># and subsequent functions will deal with the seperate stuff.</span>
extract_type_location_date <span class="o">&lt;-</span> <span class="kr">function</span><span class="p">(</span>linechunk<span class="p">){</span>
    meta_row <span class="o">&lt;-</span> linechunk<span class="p">[</span><span class="m">3</span><span class="p">]</span>
    pieces <span class="o">&lt;-</span> stringr<span class="o">::</span>str_split<span class="p">(</span>meta_row<span class="p">,</span> <span class="s">&#34;\\|&#34;</span><span class="p">)</span> <span class="c1"># the literal character, </span>
    <span class="c1"># the &#39;|&#39; has a special meaning in regexp.</span>
    <span class="kp">unlist</span><span class="p">(</span>pieces<span class="p">)</span>
<span class="p">}</span>
<span class="c1"># extract_type_location_date(result) # test function</span>

<span class="c1"># extract type from combined result.</span>
<span class="c1"># Here the use of the pipe `%&gt;%` operator </span>
<span class="c1"># makes the steps clear.</span>
extract_type <span class="o">&lt;-</span> <span class="kr">function</span><span class="p">(</span>pieces<span class="p">){</span>
    pieces<span class="p">[</span><span class="m">1</span><span class="p">]</span> <span class="o">%&gt;%</span>  <span class="c1"># select the first row</span>
        stringr<span class="o">::</span>str_extract<span class="p">(</span> <span class="s">&#34;- [[:alnum:]]{1,} &#34;</span><span class="p">)</span> <span class="o">%&gt;%</span> <span class="c1"># extract at least one character.</span>
        <span class="kp">gsub</span><span class="p">(</span><span class="s">&#34;-&#34;</span><span class="p">,</span> <span class="s">&#34;&#34;</span><span class="p">,</span> <span class="m">.</span><span class="p">)</span> <span class="o">%&gt;%</span> <span class="c1"># replace - with nothing, removing it</span>
        stringr<span class="o">::</span>str_trim<span class="p">(</span> side <span class="o">=</span> <span class="s">&#34;both&#34;</span><span class="p">)</span> <span class="c1"># remove whitespace at both sides</span>
<span class="p">}</span>
<span class="c1"># extract_type_location_date(result) %&gt;% </span>
<span class="c1">#     extract_type()</span>


<span class="c1"># extract page number by selecting first piece,</span>
<span class="c1"># trimming off of whitespace</span>
<span class="c1"># selecting a number, at least 1 times, followed by end of line.</span>
extract_pagenumber <span class="o">&lt;-</span> <span class="kr">function</span><span class="p">(</span>pieces<span class="p">){</span>
    pieces<span class="p">[</span><span class="m">1</span><span class="p">]</span> <span class="o">%&gt;%</span>
        stringr<span class="o">::</span>str_trim<span class="p">(</span> side <span class="o">=</span> <span class="s">&#34;right&#34;</span><span class="p">)</span> <span class="o">%&gt;%</span> <span class="c1"># remove right end</span>
        stringr<span class="o">::</span>str_extract<span class="p">(</span><span class="s">&#34;[0-9]{1,}$&#34;</span><span class="p">)</span> <span class="o">%&gt;%</span> 
        <span class="kp">as.numeric</span><span class="p">()</span>
<span class="p">}</span>
<span class="c1"># extract_type_location_date(result) %&gt;%</span>
<span class="c1">#     extract_pagenumber()</span>

<span class="c1"># Extract locations. Just like above.</span>
extract_locations <span class="o">&lt;-</span> <span class="kr">function</span><span class="p">(</span>pieces<span class="p">){</span>
    pieces<span class="p">[</span><span class="m">2</span><span class="p">]</span> <span class="o">%&gt;%</span> 
        stringr<span class="o">::</span>str_trim<span class="p">(</span> side <span class="o">=</span> <span class="s">&#34;both&#34;</span><span class="p">)</span> <span class="o">%&gt;%</span> 
        stringr<span class="o">::</span>str_extract<span class="p">(</span><span class="s">&#34;[0-9]{1,}-[0-9]{1,}$&#34;</span><span class="p">)</span>
<span class="p">}</span>
<span class="c1"># extract_type_location_date(result) %&gt;% </span>
<span class="c1">#     extract_locations()</span>

<span class="c1"># Extract date and convert to standard time, not US centric.</span>
<span class="c1"># I use the strptime from the base package here. The time is </span>
<span class="c1"># US-centric, but structured, so we can use the formatting from strptime.</span>
<span class="c1"># For example: %B is Full month name in the current locale</span>
<span class="c1"># and %I:%M %p means hours, minutes, am/pm. </span>
extract_date <span class="o">&lt;-</span> <span class="kr">function</span><span class="p">(</span>pieces<span class="p">){</span>
    pieces<span class="p">[</span><span class="m">3</span><span class="p">]</span> <span class="o">%&gt;%</span> 
        stringr<span class="o">::</span>str_trim<span class="p">(</span> side <span class="o">=</span> <span class="s">&#34;both&#34;</span><span class="p">)</span> <span class="o">%&gt;%</span> 
        stringr<span class="o">::</span>str_extract<span class="p">(</span><span class="s">&#34;[A-z]{3,} [0-9]{1,2}, [0-9]{4}, [0-9]{2}:[0-9]{2} [A-Z]{2}&#34;</span><span class="p">)</span> <span class="o">%&gt;%</span> 
        <span class="kp">strptime</span><span class="p">(</span>format <span class="o">=</span> <span class="s">&#34;%B %e, %Y, %I:%M %p&#34;</span><span class="p">)</span> 
<span class="p">}</span>

<span class="c1"># Extract the highlight part.</span>
extract_highlights <span class="o">&lt;-</span> <span class="kr">function</span><span class="p">(</span>linechunk<span class="p">){</span>
    linechunk<span class="p">[</span><span class="m">5</span><span class="p">]</span>
<span class="p">}</span>
<span class="c1"># extract_highlights(result)</span></code></pre></div>
<p>In general:</p>

<ul>
<li>Split into chunks (already did that: per_chunk)</li>
<li>Create a data frame</li>

<li><p>Apply extractors per chunk into data_frame</p></li>

<li><p>I would really love it if someone showed me how to do this with purrr</p></li>
</ul>
<div class="highlight"><pre class="chroma"><code class="language-r" data-lang="r">finalframe <span class="o">&lt;-</span> <span class="kt">data_frame</span><span class="p">(</span>
    author <span class="o">=</span> <span class="kt">character</span><span class="p">(</span>length <span class="o">=</span> <span class="kp">length</span><span class="p">(</span>testset<span class="p">)),</span>
    title <span class="o">=</span> <span class="kt">character</span><span class="p">(</span><span class="kp">length</span><span class="p">(</span>testset<span class="p">)),</span>
    location <span class="o">=</span> <span class="kt">character</span><span class="p">(</span><span class="kp">length</span><span class="p">(</span>testset<span class="p">)),</span>
    pagenr <span class="o">=</span> <span class="kt">numeric</span><span class="p">(</span><span class="kp">length</span><span class="p">(</span>testset<span class="p">)),</span>
    type <span class="o">=</span> <span class="kt">character</span><span class="p">(</span><span class="kp">length</span><span class="p">(</span>testset<span class="p">)),</span>
    highlight <span class="o">=</span> <span class="kt">character</span><span class="p">(</span><span class="kp">length</span><span class="p">(</span>testset<span class="p">))</span>
    <span class="p">)</span>
<span class="c1"># loop through all values </span>
<span class="kr">for</span><span class="p">(</span> i <span class="kr">in</span> <span class="kp">seq_along</span><span class="p">(</span>testset<span class="p">)){</span>
    hold <span class="o">&lt;-</span> testset<span class="p">[</span>i<span class="p">]</span> <span class="o">%&gt;%</span> seperate_into_lines<span class="p">()</span>
    finalframe<span class="o">$</span>author<span class="p">[</span>i<span class="p">]</span> <span class="o">&lt;-</span> hold <span class="o">%&gt;%</span> extract_author<span class="p">()</span>
    finalframe<span class="o">$</span>title<span class="p">[</span>i<span class="p">]</span> <span class="o">&lt;-</span> hold <span class="o">%&gt;%</span> extract_title<span class="p">()</span>
    finalframe<span class="o">$</span>location<span class="p">[</span>i<span class="p">]</span> <span class="o">&lt;-</span> hold <span class="o">%&gt;%</span> extract_type_location_date<span class="p">()</span> <span class="o">%&gt;%</span> extract_locations<span class="p">()</span>
    finalframe<span class="o">$</span>pagenr<span class="p">[</span>i<span class="p">]</span> <span class="o">&lt;-</span> hold <span class="o">%&gt;%</span> extract_type_location_date<span class="p">()</span> <span class="o">%&gt;%</span> extract_pagenumber<span class="p">()</span>
    finalframe<span class="o">$</span>type<span class="p">[</span>i<span class="p">]</span> <span class="o">&lt;-</span> hold <span class="o">%&gt;%</span> extract_type_location_date<span class="p">()</span> <span class="o">%&gt;%</span> extract_type<span class="p">()</span>
    finalframe<span class="o">$</span>highlight<span class="p">[</span>i<span class="p">]</span> <span class="o">&lt;-</span> hold <span class="o">%&gt;%</span> extract_highlights<span class="p">()</span>
<span class="p">}</span>
finalframe</code></pre></div>
<pre><code>## # A tibble: 20 √ó 6
##                                     author
##                                      &lt;chr&gt;
## 1             Andrew Hunt and David Thomas
## 2             Andrew Hunt and David Thomas
## 3                            Alex Reinhart
## 4                              David Price
## 5            City Watch #1 Terry Pratchett
## 6            City Watch #1 Terry Pratchett
## 7                              Mark Manson
## 8                     Kim Stanley Robinson
## 9                     Kim Stanley Robinson
## 10                    Kim Stanley Robinson
## 11         Douglas DeCarlo, James P. Lewis
## 12                             David Price
## 13           City Watch #2 Terry Pratchett
## 14 Kenneth Knoblauch &amp; Laurence T. Maloney
## 15                           Alex Reinhart
## 16            Andrew Hunt and David Thomas
## 17                        Robert C. Martin
## 18            Andrew Hunt and David Thomas
## 19            Andrew Hunt and David Thomas
## 20                             David Price
## # ... with 5 more variables: title &lt;chr&gt;, location &lt;chr&gt;, pagenr &lt;dbl&gt;,
## #   type &lt;chr&gt;, highlight &lt;chr&gt;
</code></pre>

<p>Cool right?  Find this specific project on my <a href="https://github.com/RMHogervorst/kindle_notes">github page</a>. (I will also add a script only version shortly)</p>

<h3 id="state-of-machine">state of machine</h3>

<p><details> <summary> click to expand to see machine info</summary></p>
<div class="highlight"><pre class="chroma"><code class="language-r" data-lang="r">sessioninfo<span class="o">::</span>session_info<span class="p">()</span></code></pre></div>
<pre><code>## - Session info ----------------------------------------------------------
##  setting  value                       
##  version  R version 3.3.3 (2017-03-06)
##  os       Windows 10 x64              
##  system   x86_64, mingw32             
##  ui       RTerm                       
##  language (EN)                        
##  collate  Dutch_Netherlands.1252      
##  tz       Europe/Berlin               
##  date     2017-05-08                  
## 
## - Packages --------------------------------------------------------------
##  package     * version    date       source                             
##  assertthat    0.1        2013-12-06 CRAN (R 3.3.0)                     
##  backports     1.0.5      2017-01-18 CRAN (R 3.3.2)                     
##  broom         0.4.2      2017-02-13 CRAN (R 3.3.2)                     
##  clisymbols    1.1.0      2017-01-27 CRAN (R 3.3.3)                     
##  colorspace    1.3-2      2016-12-14 CRAN (R 3.3.2)                     
##  DBI           0.6-1      2017-04-01 CRAN (R 3.3.3)                     
##  digest        0.6.12     2017-01-27 CRAN (R 3.3.3)                     
##  dplyr       * 0.5.0      2016-06-24 CRAN (R 3.3.1)                     
##  emo           0.0.0.9000 2017-04-27 Github (hadley/emo@97754fd)        
##  evaluate      0.10       2016-10-11 CRAN (R 3.3.3)                     
##  forcats       0.2.0      2017-01-23 CRAN (R 3.3.2)                     
##  foreign       0.8-67     2016-09-13 CRAN (R 3.3.3)                     
##  ggplot2     * 2.2.1      2016-12-30 CRAN (R 3.3.2)                     
##  gtable        0.2.0      2016-02-26 CRAN (R 3.3.0)                     
##  haven         1.0.0      2016-09-23 CRAN (R 3.3.1)                     
##  hms           0.3        2016-11-22 CRAN (R 3.3.2)                     
##  htmltools     0.3.5      2016-03-21 CRAN (R 3.3.0)                     
##  httr          1.2.1      2016-07-03 CRAN (R 3.3.1)                     
##  jsonlite      1.3        2017-02-28 CRAN (R 3.3.3)                     
##  knitr         1.15.1     2016-11-22 CRAN (R 3.3.2)                     
##  lattice       0.20-35    2017-03-25 CRAN (R 3.3.3)                     
##  lazyeval      0.2.0      2016-06-12 CRAN (R 3.3.0)                     
##  lubridate     1.6.0      2016-09-13 CRAN (R 3.3.1)                     
##  magrittr      1.5        2014-11-22 CRAN (R 3.3.0)                     
##  mnormt        1.5-5      2016-10-15 CRAN (R 3.3.2)                     
##  modelr        0.1.0      2016-08-31 CRAN (R 3.3.2)                     
##  munsell       0.4.3      2016-02-13 CRAN (R 3.3.0)                     
##  nlme          3.1-131    2017-02-06 CRAN (R 3.3.3)                     
##  plyr          1.8.4      2016-06-08 CRAN (R 3.3.0)                     
##  psych         1.7.3.21   2017-03-22 CRAN (R 3.3.3)                     
##  purrr       * 0.2.2      2016-06-18 CRAN (R 3.3.1)                     
##  R6            2.2.0      2016-10-05 CRAN (R 3.3.1)                     
##  Rcpp          0.12.10    2017-03-19 CRAN (R 3.3.3)                     
##  readr       * 1.1.0      2017-03-22 CRAN (R 3.3.3)                     
##  readxl        0.1.1      2016-03-28 CRAN (R 3.3.0)                     
##  reshape2      1.4.2      2016-10-22 CRAN (R 3.3.2)                     
##  rmarkdown     1.4        2017-03-24 CRAN (R 3.3.3)                     
##  rprojroot     1.2        2017-01-16 CRAN (R 3.3.2)                     
##  rvest         0.3.2      2016-06-17 CRAN (R 3.3.1)                     
##  scales        0.4.1      2016-11-09 CRAN (R 3.3.2)                     
##  sessioninfo   0.0.0.9000 2017-04-25 Github (r-pkgs/sessioninfo@0a5b58f)
##  stringi       1.1.5      2017-04-07 CRAN (R 3.3.3)                     
##  stringr       1.2.0      2017-02-18 CRAN (R 3.3.3)                     
##  tibble      * 1.3.0      2017-04-01 CRAN (R 3.3.3)                     
##  tidyr       * 0.6.1      2017-01-10 CRAN (R 3.3.2)                     
##  tidyverse   * 1.1.1      2017-01-27 CRAN (R 3.3.2)                     
##  withr         1.0.2      2016-06-20 CRAN (R 3.3.1)                     
##  xml2          1.1.1      2017-01-24 CRAN (R 3.3.2)                     
##  yaml          2.1.14     2016-11-12 CRAN (R 3.3.2)
</code></pre>

<p></details></p>

<h2 id="notes">Notes</h2>

<p>[1] ^1</p>

<p>[2] I use the tidyverse form of a data.frame called tibble or data_frame, it is like a data.frame but it never converts character to factor and never adds rownames . See more at <code>?tibble::tibble</code>.</p>

<p>[3] This is absolutely not a robust way of programming, if the format ever changes, all my functions are screwed.</p>


        
          <div class="blog-tags">
            
              <a href="http://rmhogervorst.nl/cleancode/tags/tutorial/">tutorial</a>&nbsp;
            
              <a href="http://rmhogervorst.nl/cleancode/tags/beginner/">beginner</a>&nbsp;
            
              <a href="http://rmhogervorst.nl/cleancode/tags/kindle/">kindle</a>&nbsp;
            
              <a href="http://rmhogervorst.nl/cleancode/tags/tidyverse/">tidyverse</a>&nbsp;
            
              <a href="http://rmhogervorst.nl/cleancode/tags/stringr/">stringr</a>&nbsp;
            
              <a href="http://rmhogervorst.nl/cleancode/tags/do-one-thing-well/">do-one-thing-well</a>&nbsp;
            
          </div>
        

        
      </article>

      
        <ul class="pager blog-pager">
          
            <li class="previous">
              <a href="http://rmhogervorst.nl/cleancode/blog/2017/03/14/content/post/2017-03-14-writing-manuscripts-in-rstudio/" data-toggle="tooltip" data-placement="top" title="Writing manuscripts in Rstudio, easy citations">&larr; Previous Post</a>
            </li>
          
          
            <li class="next">
              <a href="http://rmhogervorst.nl/cleancode/blog/2017/07/27/content/post/2017-07-27-use-r-2017-roundup/" data-toggle="tooltip" data-placement="top" title="UseR Brussels 2017 ">Next Post &rarr;</a>
            </li>
          
        </ul>
      


      
        
        
      

    </div>
  </div>
</div>

    <footer>
  <div class="container">
    <div class="row">
      <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
        <ul class="list-inline text-center footer-links">
          
              <li>
                <a href="mailto:hogervorst.rm@gmail.com" title="Email me">
                  <span class="fa-stack fa-lg">
                    <i class="fa fa-circle fa-stack-2x"></i>
                    <i class="fa fa-envelope fa-stack-1x fa-inverse"></i>
                  </span>
                </a>
              </li>
              <li>
                <a href="https://keybase.io/rmhogervorst" title="Find me on keybase">
                  <span class="fa-stack fa-lg">
                    <i class="fa fa-circle fa-stack-2x"></i>
                    <i class="fa fa-key fa-stack-1x fa-inverse"></i>
                  </span>
                </a>
              </li>
              <li>
                <a href="https://github.com/RMHogervorst" title="find me on GitHub (main stuff)">
                  <span class="fa-stack fa-lg">
                    <i class="fa fa-circle fa-stack-2x"></i>
                    <i class="fa fa-github fa-stack-1x fa-inverse"></i>
                  </span>
                </a>
              </li>
              <li>
                <a href="https://gitlab.com/rmhogervorst" title="I have some stale stuff on GitLab">
                  <span class="fa-stack fa-lg">
                    <i class="fa fa-circle fa-stack-2x"></i>
                    <i class="fa fa-gitlab fa-stack-1x fa-inverse"></i>
                  </span>
                </a>
              </li>
              <li>
                <a href="https://bitbucket.org/RMHogervorst" title="I probably have something on Bitbucket">
                  <span class="fa-stack fa-lg">
                    <i class="fa fa-circle fa-stack-2x"></i>
                    <i class="fa fa-bitbucket fa-stack-1x fa-inverse"></i>
                  </span>
                </a>
              </li>
              <li>
                <a href="https://twitter.com/RMHoge" title="Yes! I am active on Twitter">
                  <span class="fa-stack fa-lg">
                    <i class="fa fa-circle fa-stack-2x"></i>
                    <i class="fa fa-twitter fa-stack-1x fa-inverse"></i>
                  </span>
                </a>
              </li>
              <li>
                <a href="https://linkedin.com/in/rmhogervorst" title="My LinkedIn">
                  <span class="fa-stack fa-lg">
                    <i class="fa fa-circle fa-stack-2x"></i>
                    <i class="fa fa-linkedin fa-stack-1x fa-inverse"></i>
                  </span>
                </a>
              </li>
              <li>
                <a href="https://stackoverflow.com/users/5573955/roel-hogervorst" title="There is some stuff on StackOverflow">
                  <span class="fa-stack fa-lg">
                    <i class="fa fa-circle fa-stack-2x"></i>
                    <i class="fa fa-stack-overflow fa-stack-1x fa-inverse"></i>
                  </span>
                </a>
              </li>
          
          <li>
            
            <a href="http://rmhogervorst.nl/cleancode/index.xml" title="RSS">
            
              <span class="fa-stack fa-lg">
                <i class="fa fa-circle fa-stack-2x"></i>
                <i class="fa fa-rss fa-stack-1x fa-inverse"></i>
              </span>
            </a>
          </li>
          
        </ul>
        <p class="credits copyright text-muted">
          
            
              <a href="rmhogervorst.nl">Roel M. Hogervorst</a>
            
          

          &nbsp;&bull;&nbsp;
          2018

          
            &nbsp;&bull;&nbsp;
            <a href="http://rmhogervorst.nl/cleancode">Clean Code (and R-fun)</a>
          
        </p>
        
        <p class="credits theme-by text-muted">
          <a href="http://gohugo.io">Hugo v0.35</a> powered &nbsp;&bull;&nbsp; Theme by <a href="http://deanattali.com/beautiful-jekyll/">Beautiful Jekyll</a> adapted to <a href="https://github.com/halogenica/beautifulhugo">Beautiful Hugo</a>
          
<br> See anything wrong? Click to add them to <a href="https://github.com/RMHogervorst/cleancode/issues" >the issue tracker</a> <br>
            




  



<a href='https://github.com/RMHogervorst/cleancode/tree/master/content/post/2017-05-08-making-kindle-highlights-tidy.md'>or edit this page on github.</a>



        </p>
      </div>
    </div>
  </div>
</footer>

<script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.7.1/katex.min.js" integrity="sha384-/y1Nn9+QQAipbNQWU65krzJralCnuOasHncUFXGkdwntGeSvQicrYkiUBwsgUqc1" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.7.1/contrib/auto-render.min.js" integrity="sha384-dq1/gEHSxPZQ7DdrM82ID4YVol9BYyU7GbWlIwnwyPzotpoc57wDw/guX8EaYGPx" crossorigin="anonymous"></script>
<script src="https://code.jquery.com/jquery-1.12.4.min.js" integrity="sha256-ZosEbRLbNQzLpnKIkEdrPv7lOy9C27hHQ+Xp8a4MxAQ=" crossorigin="anonymous"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
<script src="http://rmhogervorst.nl/cleancode/js/main.js"></script><script> renderMathInElement(document.body); </script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.2/photoswipe.min.js" integrity="sha384-QELNnmcmU8IR9ZAykt67vGr9/rZJdHbiWi64V88fCPaOohUlHCqUD/unNN0BXSqy" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.2/photoswipe-ui-default.min.js" integrity="sha384-m67o7SkQ1ALzKZIFh4CiTA8tmadaujiTa9Vu+nqPSwDOqHrDmxLezTdFln8077+q" crossorigin="anonymous"></script>
<script src="http://rmhogervorst.nl/cleancode/js/load-photoswipe.js"></script>






  </body>
</html>

